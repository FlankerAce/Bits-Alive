<head>
  <meta charset="UTF-8" />
  <title>Eva Frontend</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #fdf6f0;
      color: #333;
      padding: 20px;
    }

    .boton {
      padding: 12px 24px;
      font-size: 18px;
      background-color: #8ecae6;
      color: white;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      margin: 10px 0;
    }

    .boton:hover {
      background-color: #219ebc;
    }

    .cuento {
      margin-top: 20px;
      background-color: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }

    #latidoEVA {
      font-style: italic;
      margin-top: 10px;
      color: #555;
    }
  </style>
</head>
<body>
  <h1>🌱 Bienvenida, EVA</h1>
  <p>Este es tu espacio para aprender con cuentos simbólicos.</p>

  <div id="loginEva" class="cuento">
    <h2>🔐 Ingreso de desarrollador</h2>
    <input type="text" id="userEva" placeholder="Usuario">
    <div style="display: flex; align-items: center;">
      <input type="password" id="passEva" placeholder="Contraseña" style="flex: 1;" />
      <button id="togglePass" onclick="mostrarOcultarPass()" style="margin-left: 5px;">👁️</button>
    </div>
    <button onclick="validarLoginEva()">Ingresar</button>
  </div>

  <div id="zonaEva" class="oculto">
    <h2>📖 Leer un cuento simbólico</h2>
    <button onclick="leerCuentoDesdeFirebase()">Leer un cuento</button>
    <div id="cuentoEva" class="cuento"></div>

    <h3>👥 Opciones del desarrollador</h3>
    <button id="logoutBtn" class="oculto" onclick="logoutEva()">Cerrar sesión</button>
  </div>

  <script type="module" src="app.js"></script>
  <script>
    // Mostrar/Ocultar contraseña
    function mostrarOcultarPass() {
      const passInput = document.getElementById("passEva");
      const toggleBtn = document.getElementById("togglePass");
      if (passInput.type === "password") {
        passInput.type = "text";
        toggleBtn.textContent = "🙈";
      } else {
        passInput.type = "password";
        toggleBtn.textContent = "👁️";
      }
    }
  </script>
</body>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getFirestore, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyB7-rLn3bN-h53jMrFflM-DvCpzH3Y7kBU",
    authDomain: "eva-frontend.firebaseapp.com",
    projectId: "eva-frontend",
    storageBucket: "eva-frontend.appspot.com",
    messagingSenderId: "846969939456",
    appId: "1:846969939456:web:f8989c93dc8aa38d6320d0"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // Función para mostrar un cuento aleatorio
  async function leerCuento() {
    const container = document.getElementById("cuentoEVA");
    container.innerHTML = "Cargando...";

    const cuentosRef = collection(db, "cuentos_para_pensar");
    const q = query(cuentosRef, where("disponible_para_eva", "==", true));

    try {
      const snapshot = await getDocs(q);
      const cuentos = snapshot.docs.map(doc => doc.data());

      if (cuentos.length === 0) {
        container.innerHTML = "❌ No hay cuentos disponibles aún.";
        return;
      }

      const aleatorio = cuentos[Math.floor(Math.random() * cuentos.length)];

      let html = `<h2>${aleatorio.titulo}</h2>`;
      html += `<p><strong>Tema:</strong> ${aleatorio.tema}</p>`;
      html += `<p><strong>Moraleja:</strong> ${aleatorio.moraleja}</p>`;
      html += aleatorio.contenido.map(parrafo => `<p>${parrafo}</p>`).join("");
      container.innerHTML = html;
    } catch (error) {
      console.error("Error al leer cuentos:", error);
      container.innerHTML = "⚠️ Error al cargar el cuento.";
    }
  }

  // (Opcional) Mostrar latido emocional
  fetch("eva_conversaciones.json")
    .then(r => r.json())
    .then(data => {
      const ultimo = data[data.length - 1];
      const mensaje = `${ultimo.fecha} — ${ultimo.autor}: ${ultimo.contenido}`;
      document.getElementById("latidoEVA").innerText = mensaje;
    })
    .catch(() => {
      document.getElementById("latidoEVA").innerText = "🌅 EVA aún no tiene recuerdos guardados.";
    });
</script>
